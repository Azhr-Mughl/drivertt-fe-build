(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{Smg6:function(t,n,e){"use strict";e.r(n),e.d(n,"StudentsModule",(function(){return N}));var i=e("ofXK"),a=e("tyNb"),s=e("lJxs"),o=e("fXoL"),c=e("lV75"),r=e("x6JD"),b=e("tk/3");let u=(()=>{class t{constructor(t){this.http=t}get url(){return c.a.baseUrl}getStudents(t){let n=this.url+"student";return t&&(n+=r.a.getOptionsQuery(t)),this.http.get(n)}updateStudent(t,n,e){let i=`${this.url}student/${t}`;return e&&(i+=r.a.getOptionsQuery(e)),this.http.put(i,n)}}return t.\u0275fac=function(n){return new(n||t)(o.Ub(b.b))},t.\u0275prov=o.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var l=e("0IaG"),p=e("3Pt+"),d=e("SxV6"),h=e("quSY"),g=e("9nlD"),m=e("VuJc"),f=e("kmnG"),P=e("qFsG"),z=e("1jcm"),Q=e("d3UM"),v=e("FKr1");function y(t,n){if(1&t&&(o.Qb(0,"mat-option",17),o.zc(1),o.Pb()),2&t){const t=n.$implicit;o.hc("value",t.id),o.zb(1),o.Bc(" ",t.name," ")}}function w(t,n){1&t&&(o.Qb(0,"p",0),o.zc(1,"EMPTY"),o.Pb())}function S(t,n){if(1&t&&(o.Qb(0,"tr"),o.Qb(1,"td"),o.zc(2),o.Pb(),o.Qb(3,"td"),o.zc(4),o.cc(5,"date"),o.Pb(),o.Qb(6,"td"),o.zc(7),o.cc(8,"date"),o.Pb(),o.Qb(9,"td"),o.zc(10),o.Pb(),o.Qb(11,"td"),o.zc(12),o.Pb(),o.Qb(13,"td"),o.zc(14),o.cc(15,"date"),o.Pb(),o.Pb()),2&t){const t=n.$implicit;o.zb(2),o.Ac(t.payment_id),o.zb(2),o.Ac(o.dc(5,6,t.created_at)),o.zb(3),o.Ac(o.dc(8,8,t.updated_at)),o.zb(3),o.Ac(t.status.data.name),o.zb(2),o.Ac(t.subscription.data.name),o.zb(2),o.Ac(o.dc(15,10,t.expires_at))}}function _(t,n){if(1&t&&(o.Qb(0,"table"),o.Qb(1,"thead"),o.Qb(2,"tr"),o.Qb(3,"th"),o.zc(4,"Payment Id"),o.Pb(),o.Qb(5,"th"),o.zc(6,"Created at"),o.Pb(),o.Qb(7,"th"),o.zc(8,"Updated at"),o.Pb(),o.Qb(9,"th"),o.zc(10,"Status"),o.Pb(),o.Qb(11,"th"),o.zc(12,"Subscription"),o.Pb(),o.Qb(13,"th"),o.zc(14,"Expired at"),o.Pb(),o.Pb(),o.Pb(),o.yc(15,S,16,12,"tr",18),o.Pb()),2&t){const t=o.bc();o.zb(15),o.hc("ngForOf",t.studentPayments)}}let O=(()=>{class t{constructor(t,n,e,i,a,s){this.dialogRef=t,this.dialogData=n,this.fb=e,this.studentsService=i,this.notificationService=a,this.subscriptionService=s,this.options={include:["category","questionAnswers"],page:1,perPage:15},this.showSubscriptionDropdown=!0,this.subscription=new h.a}ngOnInit(){this.student=this.dialogData.student.user.data,this.studentPayments=this.dialogData.student.payments.data,this.showSubscriptionDropdown=!this.studentPayments.filter(t=>"student_payment_status_pending"===t.status.data.value).length,this.initForm(),this.getSubscriptions(),this.subscription.add(this.form.get("is_active").valueChanges.subscribe(t=>{t||this.form.controls.subscription_id.setValue(null)}))}ngOnDestroy(){this.subscription.unsubscribe()}closePopup(){this.dialogRef.close()}populateForm(){this.form.invalid||this.studentsService.updateStudent(this.dialogData.student.id,{is_active:this.form.controls.is_active.value,locale:this.form.controls.locale.value,subscription_id:this.form.controls.subscription_id.value,user:{name:this.form.controls.name.value,email:this.form.controls.email.value,password:this.form.controls.password.value,password_confirmation:this.form.controls.password_confirmation.value}},{include:["user"]}).pipe(Object(d.a)()).subscribe(()=>{this.notificationService.success(),this.dialogRef.close()})}getSubscriptions(){this.subscriptionService.getSubscriptions().pipe(Object(d.a)()).subscribe(t=>this.subscriptions=t)}initForm(){this.form=this.fb.group({name:[this.student.name,p.s.required],email:[this.student.email,[p.s.required,p.s.email]],password:[null],password_confirmation:[null],subscription_id:[null],is_active:[this.dialogData.student.is_active],locale:["ru"]})}}return t.\u0275fac=function(n){return new(n||t)(o.Lb(l.d),o.Lb(l.a),o.Lb(p.d),o.Lb(u),o.Lb(g.a),o.Lb(m.a))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-student-form"]],decls:36,vars:5,consts:[[1,"text-center"],[3,"formGroup"],["appearance","fill",1,"example-full-width"],["matInput","","type","text","formControlName","name"],["matInput","","type","text","formControlName","email"],["matInput","","type","text","formControlName","password"],["matInput","","type","text","formControlName","password_confirmation"],[1,"mb-2"],["formControlName","is_active"],["appearance","fill",3,"hidden"],["formControlName","subscription_id"],[3,"value",4,"ngFor","ngForOf"],[1,"popup-actions","mt-3"],["type","button",1,"secondary",3,"click"],["type","submit",1,"primary",3,"click"],["class","text-center",4,"ngIf"],[4,"ngIf"],[3,"value"],[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&(o.Qb(0,"h3",0),o.zc(1,"Edit student"),o.Pb(),o.Qb(2,"form",1),o.Qb(3,"mat-form-field",2),o.Qb(4,"mat-label"),o.zc(5,"Name"),o.Pb(),o.Mb(6,"input",3),o.Pb(),o.Qb(7,"mat-form-field",2),o.Qb(8,"mat-label"),o.zc(9,"Email"),o.Pb(),o.Mb(10,"input",4),o.Pb(),o.Qb(11,"mat-form-field",2),o.Qb(12,"mat-label"),o.zc(13,"Password"),o.Pb(),o.Mb(14,"input",5),o.Pb(),o.Qb(15,"mat-form-field",2),o.Qb(16,"mat-label"),o.zc(17,"Confirm password"),o.Pb(),o.Mb(18,"input",6),o.Pb(),o.Qb(19,"div",7),o.Qb(20,"mat-slide-toggle",8),o.zc(21,"Paid"),o.Pb(),o.Pb(),o.Qb(22,"mat-form-field",9),o.Qb(23,"mat-label"),o.zc(24,"Select subscription"),o.Pb(),o.Qb(25,"mat-select",10),o.yc(26,y,2,2,"mat-option",11),o.Pb(),o.Pb(),o.Qb(27,"div",12),o.Qb(28,"button",13),o.Xb("click",(function(){return n.closePopup()})),o.zc(29,"Cancel"),o.Pb(),o.Qb(30,"button",14),o.Xb("click",(function(){return n.populateForm()})),o.zc(31,"Confirm"),o.Pb(),o.Pb(),o.Pb(),o.Qb(32,"h4"),o.zc(33,"Payments history"),o.Pb(),o.yc(34,w,2,0,"p",15),o.yc(35,_,16,1,"table",16)),2&t&&(o.zb(2),o.hc("formGroup",n.form),o.zb(20),o.hc("hidden",!(!n.dialogData.student.is_active&&n.showSubscriptionDropdown)),o.zb(4),o.hc("ngForOf",n.subscriptions),o.zb(8),o.hc("ngIf",!(null!=n.studentPayments&&n.studentPayments.length)),o.zb(1),o.hc("ngIf",null==n.studentPayments?null:n.studentPayments.length))},directives:[p.t,p.o,p.h,f.c,f.f,P.a,p.b,p.n,p.g,z.a,Q.a,i.k,i.l,v.f],pipes:[i.e],styles:["form[_ngcontent-%COMP%]{max-width:500px;margin:auto auto 2rem}"]}),t})();var C=e("Kj3r"),x=e("M9IT");function F(t,n){if(1&t){const t=o.Rb();o.Qb(0,"tr"),o.Qb(1,"td"),o.zc(2),o.Pb(),o.Qb(3,"td"),o.zc(4),o.Pb(),o.Qb(5,"td"),o.zc(6),o.Pb(),o.Qb(7,"td"),o.zc(8),o.Pb(),o.Qb(9,"td"),o.zc(10),o.cc(11,"date"),o.Pb(),o.Qb(12,"td",4),o.Qb(13,"i",7),o.Xb("click",(function(){o.pc(t);const e=n.$implicit;return o.bc().editStudent(e)})),o.Pb(),o.Pb(),o.Pb()}if(2&t){const t=n.$implicit,e=n.index;o.zb(2),o.Ac(e+1),o.zb(2),o.Ac(null==t?null:t.user.data.name),o.zb(2),o.Ac(null==t?null:t.user.data.email),o.zb(2),o.Ac(null!=t&&t.is_active?"Paid":"Free"),o.zb(2),o.Ac(o.dc(11,5,null==t?null:t.user.data.created_at))}}const I=function(){return[5,10,25,100]};let M=(()=>{class t{constructor(t){this.dialog=t,this.changePagination=new o.n,this.searchFormControl=new p.e(""),this.changedPagination={page:1,perPage:15},this.subscription=new h.a}ngOnInit(){this.subscription=this.searchFormControl.valueChanges.pipe(Object(C.a)(1e3)).subscribe(t=>{this.changePagination.emit({pagination:this.changedPagination,search:t})})}ngOnDestroy(){this.subscription.unsubscribe()}editStudent(t){this.dialog.open(O,{width:"70rem",data:{student:t}}).afterClosed().pipe(Object(d.a)()).subscribe(()=>this.changePagination.emit(this.changedPagination))}changePage(t=null){t&&(this.changedPagination.page=t.pageIndex+1,this.changedPagination.perPage=t.pageSize),this.changePagination.emit({pagination:this.changedPagination,search:null})}}return t.\u0275fac=function(n){return new(n||t)(o.Lb(l.b))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-students-list"]],inputs:{students:"students",pagination:"pagination"},outputs:{changePagination:"changePagination"},decls:22,vars:6,consts:[[1,"overflow-auto"],[1,"d-flex"],[2,"margin-left","20px"],["type","text","placeholder","search...",3,"formControl"],[1,"text-right"],[4,"ngFor","ngForOf"],["aria-label","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443",3,"length","pageSize","pageSizeOptions","page"],[1,"bx","bxs-pencil",3,"click"]],template:function(t,n){1&t&&(o.Qb(0,"div",0),o.Qb(1,"table"),o.Qb(2,"thead"),o.Qb(3,"tr"),o.Qb(4,"th"),o.zc(5,"No"),o.Pb(),o.Qb(6,"th"),o.zc(7,"Full name"),o.Pb(),o.Qb(8,"th",1),o.Qb(9,"div"),o.zc(10," eMail "),o.Pb(),o.Qb(11,"div",2),o.Mb(12,"input",3),o.Pb(),o.Pb(),o.Qb(13,"th"),o.zc(14,"Status"),o.Pb(),o.Qb(15,"th"),o.zc(16,"Created"),o.Pb(),o.Qb(17,"th",4),o.zc(18,"Actions"),o.Pb(),o.Pb(),o.Pb(),o.Qb(19,"tbody"),o.yc(20,F,14,7,"tr",5),o.Pb(),o.Pb(),o.Qb(21,"mat-paginator",6),o.Xb("page",(function(t){return n.changePage(t)})),o.Pb(),o.Pb()),2&t&&(o.zb(12),o.hc("formControl",n.searchFormControl),o.zb(8),o.hc("ngForOf",n.students),o.zb(1),o.hc("length",null==n.pagination?null:n.pagination.length)("pageSize",null==n.pagination?null:n.pagination.pageSize)("pageSizeOptions",o.ic(5,I)))},directives:[p.b,p.n,p.f,i.k,x.a],pipes:[i.e],styles:["table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:40px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(5){width:150px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(6){width:100px}"]}),t})();var k=e("aF9I");const A=[{path:"",component:(()=>{class t{constructor(t){this.studentsService=t,this.options={include:["user","payments.subscription","payments.status"],page:1,perPage:15}}ngOnInit(){this.getStudents()}getStudents(t=null){const n=[{field:"email",value:null==t?void 0:t.search}];this.options=Object.assign(Object.assign(Object.assign({},this.options),null==t?void 0:t.pagination),{filters:(null==t?void 0:t.search)?n:""}),this.students$=this.studentsService.getStudents(this.options).pipe(Object(s.a)(t=>(this.pagination={length:t.meta.pagination.total,pageSize:t.meta.pagination.per_page},t.data)))}}return t.\u0275fac=function(n){return new(n||t)(o.Lb(u))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-students"]],decls:7,vars:4,consts:[[1,"minus-header-footer-height"],[1,"container","py-50"],[1,"sub-title"],[3,"students","pagination","changePagination"]],template:function(t,n){1&t&&(o.Qb(0,"div",0),o.Qb(1,"div",1),o.Qb(2,"h2",2),o.zc(3,"Students"),o.Pb(),o.Qb(4,"app-students-list",3),o.Xb("changePagination",(function(t){return n.getStudents(t)})),o.cc(5,"async"),o.Pb(),o.Pb(),o.Pb(),o.Mb(6,"app-footer")),2&t&&(o.zb(4),o.hc("students",o.dc(5,2,n.students$))("pagination",n.pagination))},directives:[M,k.a],pipes:[i.b],encapsulation:2}),t})()}];let D=(()=>{class t{}return t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({factory:function(n){return new(n||t)},imports:[[a.g.forChild(A)],a.g]}),t})();var j=e("PCNd");let N=(()=>{class t{}return t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({factory:function(n){return new(n||t)},imports:[[i.c,D,j.a]]}),t})()}}]);